[
    {% for page in site.pages %}
    {% unless page.exclude_from_search %}
    {
        "title": "{{ page.title | default: page.name | escape }}",
        "url": "{{ page.url | relative_url }}",
        "content": "{{ page.content | strip_html | normalize_whitespace | escape }}",
        "excerpt": "{{ page.excerpt | default: page.content | strip_html | normalize_whitespace | escape | truncate: 200 }}"
    }{% unless forloop.last %},{% endunless %}
    {% endunless %}
    {% endfor %}
    
    {% if site.posts.size > 0 %},{% endif %}
    
    {% for post in site.posts %}
    {
        "title": "{{ post.title | escape }}",
        "url": "{{ post.url | relative_url }}",
        "content": "{{ post.content | strip_html | normalize_whitespace | escape }}",
        "excerpt": "{{ post.excerpt | default: post.content | strip_html | normalize_whitespace | escape | truncate: 200 }}",
        "tags": "{{ post.tags | join: ', ' | escape }}",
        "categories": "{{ post.categories | join: ', ' | escape }}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
    
    {% if site.collections %}
    {% for collection in site.collections %}
    {% if collection.label != "posts" %}
    {% for doc in collection.docs %}
    ,{
        "title": "{{ doc.title | escape }}",
        "url": "{{ doc.url | relative_url }}",
        "content": "{{ doc.content | strip_html | normalize_whitespace | escape }}",
        "excerpt": "{{ doc.excerpt | default: doc.content | strip_html | normalize_whitespace | escape | truncate: 200 }}"
    }
    {% endfor %}
    {% endif %}
    {% endfor %}
    {% endif %}
]
